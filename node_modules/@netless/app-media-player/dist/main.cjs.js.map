{"version":3,"file":"main.cjs.js","sources":["../src/constants.ts","../src/options.ts","../src/utils.ts","../../../node_modules/lodash-es/_freeGlobal.js","../../../node_modules/lodash-es/_root.js","../../../node_modules/lodash-es/_Symbol.js","../../../node_modules/lodash-es/_getRawTag.js","../../../node_modules/lodash-es/_objectToString.js","../../../node_modules/lodash-es/_baseGetTag.js","../../../node_modules/lodash-es/_trimmedEndIndex.js","../../../node_modules/lodash-es/_baseTrim.js","../../../node_modules/lodash-es/isObject.js","../../../node_modules/lodash-es/toNumber.js","../../../node_modules/lodash-es/isSymbol.js","../../../node_modules/lodash-es/isObjectLike.js","../../../node_modules/lodash-es/now.js","../../../node_modules/lodash-es/debounce.js","../src/components/SeekSlider.tsx","../src/components/PlayerController.tsx","../src/components/icons/video_play.svg","../src/components/icons/video_pause.svg","../src/components/icons/volume2.svg","../src/components/icons/volume0.svg","../src/components/icons/volume1.svg","../src/components/MediaPlayer.tsx","../src/index.tsx"],"sourcesContent":["import type { Attributes } from \"./types\";\n\n/** 插件 ID */\nexport const Kind = \"MediaPlayer\";\n\nexport const Version = \"0.1.0-alpha.5\";\n\nexport const defaultAttributes: Attributes = {\n    src: \"\",\n    currentTime: 0,\n    hostTime: 0,\n    muted: false,\n    paused: true,\n    volume: 1,\n};\n","import type { VideoJsPlayer } from \"video.js\";\n\nexport interface MediaPlayerOptions {\n    /**\n     * 播放器时间和全局时间最大误差（秒）\n     * 超过这个时间就会触发一次 `currentTime(globalTime)`\n     * - 如果设得太小，播放器会一卡一卡的\n     * - 如果设得太大，两边播放时间会相差比较远\n     * @default 1\n     */\n    currentTimeMaxError: number;\n\n    /**\n     * 同步全局状态的时间间隔（毫秒）\n     * 每隔这段时间同步一次全局状态\n     * @default 1000\n     */\n    syncInterval: number;\n\n    /**\n     * 恢复重试间隔（毫秒）\n     * 每隔这段时间恢复一次重试的机会\n     * @default 15000\n     */\n    retryInterval: number;\n\n    /**\n     * 可以自定义播放器的接口，每次创建出一个播放器都会调一下这个函数\n     */\n    onPlayer?: (player: VideoJsPlayer) => void;\n\n    /**\n     * 自定义 log 函数\n     */\n    log: Console[\"log\"];\n\n    /**\n     * 是否 log\n     */\n    verbose: boolean;\n}\n\nexport const defaultOptions: MediaPlayerOptions = {\n    currentTimeMaxError: 1,\n    syncInterval: 1000,\n    retryInterval: 15000,\n    verbose: false,\n    log: console.log.bind(console),\n};\n\nexport let options = defaultOptions;\n\nexport function setOptions(userDefined: Partial<MediaPlayerOptions>) {\n    options = { ...defaultOptions, ...userDefined };\n}\n","import type { Player, Room } from \"@netless/window-manager\";\nimport type { ImplProps } from \"./components/MediaPlayer\";\nimport type { Attributes } from \"./types\";\nimport { Version } from \"./constants\";\n\nexport function checkWhiteWebSdkVersion(room: Room) {\n    if (!room.calibrationTimestamp) {\n        // prettier-ignore\n        throw new Error(`@netless/app-media-player@${Version} requires white-web-sdk@^2.13.8 to work properly.`);\n    }\n}\n\nexport function nextFrame() {\n    return new Promise(r => (window.requestAnimationFrame || window.setTimeout)(r));\n}\n\nexport function getCurrentTime(attributes: Attributes, props: ImplProps) {\n    if (attributes.paused) {\n        return attributes.currentTime;\n    }\n    const now = getTimestamp(props);\n    if (now) {\n        return attributes.currentTime + (now - attributes.hostTime) / 1000;\n    } else {\n        return attributes.currentTime;\n    }\n}\n\nexport function getTimestamp(props: { player?: Player; room?: Room }) {\n    if (props.player) {\n        return props.player.beginTimestamp + props.player.progressTime;\n    }\n    if (props.room) {\n        return props.room.calibrationTimestamp;\n    }\n}\n\nexport const isSafari = navigator.userAgent.includes(\"Safari\");\n\nexport const AudioExts = [\".aac\", \".mid\", \".midi\", \".mp3\", \".ogg\", \".oga\", \".wav\", \".weba\"];\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nexport default trimmedEndIndex;\n","import trimmedEndIndex from './_trimmedEndIndex.js';\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nexport default baseTrim;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseTrim from './_baseTrim.js';\nimport isObject from './isObject.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nexport default toNumber;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import root from './_root.js';\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nexport default now;\n","import isObject from './isObject.js';\nimport now from './now.js';\nimport toNumber from './toNumber.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nexport default debounce;\n","import React, { Component } from \"react\";\n\nexport interface Time {\n    hh: string;\n    mm: string;\n    ss: string;\n}\n\nexport interface VideoSeekSliderProps {\n    total: number;\n    current: number;\n    onChange: (value: number) => void;\n    buffered?: number;\n    hideHoverTime?: boolean;\n    secondsPrefix?: string;\n    minutesPrefix?: string;\n    limitTimeTooltipBySides?: boolean;\n    sliderColor?: string;\n    sliderHoverColor?: string;\n    thumbColor?: string;\n    bufferColor?: string;\n    paused?: boolean;\n    play?: () => void;\n    pause?: () => void;\n    onSeekStart?: () => void;\n    onSeekEnd?: () => void;\n    scale?: number;\n}\n\nexport interface VideoSeekSliderStates {\n    ready: boolean;\n    trackWidth: number;\n    seekHoverPosition: number;\n}\n\nexport interface TransformType {\n    transform: string;\n}\n\nexport default class SeekSlider extends Component<VideoSeekSliderProps, VideoSeekSliderStates> {\n    private seeking = false;\n    private mobileSeeking = false;\n    private track: HTMLDivElement | null = null;\n    private hoverTime: HTMLDivElement | null = null;\n    private offset: number = 0;\n    private secondsPrefix: string = \"00:00:\";\n    private minutesPrefix: string = \"00:\";\n    private seekPause: boolean = false;\n\n    public constructor(props: VideoSeekSliderProps) {\n        super(props);\n        if (this.props.secondsPrefix) {\n            this.secondsPrefix = this.props.secondsPrefix;\n        }\n        if (this.props.minutesPrefix) {\n            this.minutesPrefix = this.props.minutesPrefix;\n        }\n        this.state = {\n            ready: false,\n            trackWidth: 0,\n            seekHoverPosition: 0,\n        };\n    }\n\n    public componentDidMount(): void {\n        this.setTrackWidthState();\n        window.addEventListener(\"resize\", this.setTrackWidthState);\n        window.addEventListener(\"mousemove\", this.handleSeeking);\n        window.addEventListener(\"mouseup\", this.mouseSeekingHandler);\n        window.addEventListener(\"touchmove\", this.handleTouchSeeking);\n        window.addEventListener(\"touchend\", this.mobileTouchSeekingHandler);\n    }\n\n    public componentWillUnmount(): void {\n        window.removeEventListener(\"resize\", this.setTrackWidthState);\n        window.removeEventListener(\"mousemove\", this.handleSeeking);\n        window.removeEventListener(\"mouseup\", this.mouseSeekingHandler);\n        window.removeEventListener(\"touchmove\", this.handleTouchSeeking);\n        window.removeEventListener(\"touchend\", this.mobileTouchSeekingHandler);\n    }\n\n    private handleTouchSeeking = (event: any): void => {\n        let pageX: number = 0;\n\n        for (let i = 0; i < event.changedTouches.length; i++) {\n            pageX = event.changedTouches[i].pageX;\n        }\n\n        pageX = pageX < 0 ? 0 : pageX;\n\n        if (this.mobileSeeking) {\n            this.changeCurrentTimePosition(pageX);\n        }\n    };\n\n    private handleSeeking = (evt: any): void => {\n        if (this.seeking) {\n            this.changeCurrentTimePosition(evt.pageX);\n        }\n    };\n\n    private changeCurrentTimePosition(pageX: number): void {\n        if (this.track) {\n            const scale = this.props.scale || 1;\n            let position = (pageX - this.track.getBoundingClientRect().left) / scale;\n            position = Math.min(this.state.trackWidth, Math.max(0, position));\n            this.setState({ seekHoverPosition: position });\n            const percent = position / this.state.trackWidth;\n            const time = +(percent * this.props.total).toFixed(0);\n            this.props.onChange(time);\n        }\n    }\n\n    private setTrackWidthState = (): void => {\n        if (this.track) {\n            this.setState({ trackWidth: this.track.offsetWidth });\n        }\n    };\n\n    private handleTrackHover = (clear: boolean, evt: React.MouseEvent): void => {\n        if (this.track) {\n            const scale = this.props.scale || 1;\n            let position: number;\n            if (clear) {\n                position = 0;\n            } else {\n                position = (evt.pageX - this.track.getBoundingClientRect().left) / scale;\n            }\n            this.setState({ seekHoverPosition: position, trackWidth: this.track.offsetWidth });\n        }\n    };\n\n    private getPositionStyle(time: number): TransformType {\n        const position: number = (time * 100) / this.props.total;\n        return { transform: `scaleX(${position / 100})` };\n    }\n\n    private getThumbHandlerPosition(): TransformType {\n        const position: number = this.state.trackWidth / (this.props.total / this.props.current);\n        return { transform: `translateX(${position}px)` };\n    }\n\n    private getSeekHoverPosition(): TransformType {\n        const position: number = (this.state.seekHoverPosition * 100) / this.state.trackWidth;\n        return { transform: `scaleX(${position / 100})` };\n    }\n\n    private getHoverTimePosition(): TransformType {\n        let position: number = 0;\n        if (this.hoverTime) {\n            position = this.state.seekHoverPosition - this.hoverTime.offsetWidth / 2;\n            if (this.props.limitTimeTooltipBySides) {\n                if (position < 0) {\n                    position = 0;\n                } else if (position + this.hoverTime.offsetWidth > this.state.trackWidth) {\n                    position = this.state.trackWidth - this.hoverTime.offsetWidth;\n                }\n            }\n        }\n        return {\n            transform: `translateX(${position}px)`,\n        };\n    }\n\n    private secondsToTime(seconds: number): Time {\n        seconds = Math.round(seconds + this.offset);\n        const hours: number = Math.floor(seconds / 3600);\n        const divForMinutes: number = seconds % 3600;\n        const minutes: number = Math.floor(divForMinutes / 60);\n        const sec: number = Math.ceil(divForMinutes % 60);\n        return {\n            hh: hours.toString(),\n            mm: minutes < 10 ? \"0\" + minutes : minutes.toString(),\n            ss: sec < 10 ? \"0\" + sec : sec.toString(),\n        };\n    }\n\n    private getHoverTime(): string {\n        const percent: number = (this.state.seekHoverPosition * 100) / this.state.trackWidth;\n        const time: number = Math.floor(+(percent * (this.props.total / 100)));\n        const times: Time = this.secondsToTime(time);\n        if (this.props.total + this.offset < 60) {\n            return this.secondsPrefix + times.ss;\n        } else if (this.props.total + this.offset < 3600) {\n            return this.minutesPrefix + times.mm + \":\" + times.ss;\n        } else {\n            return times.hh + \":\" + times.mm + \":\" + times.ss;\n        }\n    }\n\n    private mouseSeekingHandler = (event: any): void => {\n        this.setSeeking(false, event);\n        this.onMouseUp();\n    };\n\n    private setSeeking = (state: boolean, evt: React.MouseEvent | React.TouchEvent): void => {\n        evt.preventDefault();\n        this.handleSeeking(evt);\n        this.seeking = state;\n        this.setState({ seekHoverPosition: !state ? 0 : this.state.seekHoverPosition });\n    };\n\n    private mobileTouchSeekingHandler = (): void => {\n        this.setMobileSeeking(false);\n    };\n\n    private setMobileSeeking = (state: boolean): void => {\n        this.mobileSeeking = state;\n        this.setState({ seekHoverPosition: !state ? 0 : this.state.seekHoverPosition });\n    };\n\n    private isThumbActive(): boolean {\n        return this.state.seekHoverPosition > 0 || this.seeking;\n    }\n\n    private renderBufferProgress = (): React.ReactNode => {\n        if (this.props.buffered) {\n            const style = {\n                ...this.getPositionStyle(this.props.buffered),\n                ...(this.props.bufferColor && { backgroundColor: this.props.bufferColor }),\n            };\n            return <div className=\"buffered\" style={style} />;\n        } else {\n            return null;\n        }\n    };\n\n    private renderProgress = () => {\n        const style = {\n            ...this.getPositionStyle(this.props.current),\n            ...(this.props.sliderColor && { backgroundColor: this.props.sliderColor }),\n        };\n        return <div className=\"connect\" style={style} />;\n    };\n\n    private renderHoverProgress = () => {\n        const style = {\n            ...this.getSeekHoverPosition(),\n            ...(this.props.sliderHoverColor && { backgroundColor: this.props.sliderHoverColor }),\n        };\n        return <div className=\"seek-hover\" style={style} />;\n    };\n\n    private renderThumb = (): React.ReactNode => {\n        return (\n            <div\n                className={this.isThumbActive() ? `thumb active` : \"thumb\"}\n                style={this.getThumbHandlerPosition()}\n            >\n                <div style={{ backgroundColor: this.props.thumbColor }} className=\"handler\" />\n            </div>\n        );\n    };\n\n    private drawHoverTime(): React.ReactNode {\n        if (!this.props.hideHoverTime) {\n            return (\n                <div\n                    className={this.isThumbActive() ? `hover-time active` : \"hover-time\"}\n                    style={this.getHoverTimePosition()}\n                    ref={ref => (this.hoverTime = ref)}\n                >\n                    {this.getHoverTime()}\n                </div>\n            );\n        } else {\n            return null;\n        }\n    }\n\n    private onMouseDown = (event: React.MouseEvent | React.TouchEvent) => {\n        if (this.props.pause && !this.props.paused) {\n            this.props.pause();\n            this.seekPause = true;\n        }\n        this.setSeeking(true, event);\n        this.props.onSeekStart?.();\n    };\n\n    private onMouseUp = () => {\n        if (this.props.play && this.seekPause) {\n            this.props.play();\n            this.seekPause = false;\n        }\n        this.props.onSeekEnd?.();\n    };\n\n    public render(): React.ReactNode {\n        return (\n            <div className=\"seek-slider\">\n                <div\n                    className=\"track\"\n                    ref={ref => (this.track = ref)}\n                    onMouseMove={evt => this.handleTrackHover(false, evt)}\n                    onMouseLeave={evt => this.handleTrackHover(true, evt)}\n                    onMouseDown={this.onMouseDown}\n                    onTouchStart={evt => {\n                        this.setMobileSeeking(true);\n                        this.onMouseDown(evt);\n                    }}\n                    onMouseUp={this.onMouseUp}\n                    onTouchEnd={this.onMouseUp}\n                >\n                    <div className=\"main\">\n                        {this.renderBufferProgress()}\n                        {this.renderHoverProgress()}\n                        {this.renderProgress()}\n                    </div>\n                </div>\n                {this.drawHoverTime()}\n                {this.renderThumb()}\n            </div>\n        );\n    }\n}\n","import { debounce } from \"lodash-es\";\nimport React, { Component } from \"react\";\nimport video_pause from \"./icons/video_pause.svg\";\nimport video_play from \"./icons/video_play.svg\";\nimport volume0 from \"./icons/volume0.svg\";\nimport volume1 from \"./icons/volume1.svg\";\nimport volume2 from \"./icons/volume2.svg\";\nimport SeekSlider from \"./SeekSlider\";\n\nexport interface PlayerControllerProps {\n    duration: number;\n    currentTime: number;\n    setCurrentTime: (time: number) => void;\n    paused: boolean;\n    play: () => void;\n    pause: () => void;\n    volume: number;\n    setVolume: (volume: number) => void;\n    buffered: number;\n    visible: boolean;\n    scale?: number;\n}\n\nexport interface PlayerControllerStates {\n    isPlayerSeeking: boolean;\n    isVolumeHover: boolean;\n    seekVolume: number;\n    visible: boolean;\n    currentTime: number;\n}\n\nexport default class PlayerController extends Component<\n    PlayerControllerProps,\n    PlayerControllerStates\n> {\n    private stageVolume = 0;\n    private updateVolumeTimer = 0;\n    private onVolumeSeeking = false;\n\n    public constructor(props: PlayerControllerProps) {\n        super(props);\n        this.state = {\n            isPlayerSeeking: false,\n            isVolumeHover: false,\n            seekVolume: 1,\n            visible: true,\n            currentTime: 0,\n        };\n        this.stageVolume = props.volume;\n    }\n\n    public componentDidMount(): void {\n        this.updateVolumeTimer = setInterval(() => {\n            if (!this.onVolumeSeeking) {\n                this.setState({ seekVolume: this.props.volume });\n            }\n            if (!this.state.isPlayerSeeking) {\n                this.setState({ currentTime: this.props.currentTime });\n            }\n        }, 100);\n    }\n\n    public componentWillUnmount() {\n        if (this.updateVolumeTimer) {\n            clearInterval(this.updateVolumeTimer);\n        }\n    }\n\n    private onClickOperationButton = (): void => {\n        const { paused } = this.props;\n        if (paused) {\n            this.props.play();\n        } else {\n            this.props.pause();\n        }\n    };\n\n    private operationButton = (): React.ReactNode => {\n        const { paused } = this.props;\n        if (paused) {\n            return <img src={video_play} />;\n        } else {\n            return <img src={video_pause} />;\n        }\n    };\n\n    private operationVolumeButton = (): React.ReactNode => {\n        if (this.props.volume > 0.9) {\n            return <img src={volume2} />;\n        } else if (this.props.volume === 0) {\n            return <img src={volume0} />;\n        } else {\n            return <img src={volume1} />;\n        }\n    };\n\n    private handleClickVolume = (): void => {\n        if (this.props.volume === 0) {\n            if (this.stageVolume !== 0) {\n                this.props.setVolume(this.stageVolume);\n            } else {\n                this.props.setVolume(1);\n            }\n        } else {\n            this.stageVolume = this.props.volume;\n            this.props.setVolume(0);\n        }\n    };\n\n    private onChange = (currentTime: number) => {\n        this.setState({ currentTime });\n        currentTime && this.changeTime(currentTime);\n    };\n\n    private changeTime = debounce((time: number) => {\n        this.props.setCurrentTime(time);\n    }, 50);\n\n    private onVolumeChange = (time: number) => {\n        this.changeVolume(time);\n        this.setState({ seekVolume: time / 100 });\n    };\n\n    private changeVolume = debounce((time: number) => {\n        this.props.setVolume(time / 100);\n    }, 50);\n\n    private onVolumeSeekStart = () => {\n        this.onVolumeSeeking = true;\n    };\n\n    private onVolumeSeekEnd = debounce(() => {\n        this.onVolumeSeeking = false;\n    }, 500);\n\n    private onProgressSeekStart = () => this.setState({ isPlayerSeeking: true });\n\n    private onProgressSeekEnd = debounce(() => {\n        this.setState({ isPlayerSeeking: false });\n    }, 500);\n\n    public render(): React.ReactNode {\n        const { duration, currentTime: progressTime } = this.props;\n        return (\n            <div className=\"player-controller\" style={{ opacity: this.props.visible ? \"1\" : \"0\" }}>\n                <div className=\"player-controller-progress\">\n                    <SeekSlider\n                        total={duration}\n                        current={this.state.currentTime}\n                        onChange={this.onChange}\n                        buffered={this.props.buffered}\n                        bufferColor={\"rgba(255,255,255,0.3)\"}\n                        hideHoverTime\n                        limitTimeTooltipBySides\n                        onSeekStart={this.onProgressSeekStart}\n                        onSeekEnd={this.onProgressSeekEnd}\n                        play={this.props.play}\n                        pause={this.props.pause}\n                        paused={this.props.paused}\n                        scale={this.props.scale}\n                    />\n                </div>\n                <div className=\"player-controller-actions\">\n                    <div className=\"player-controller-actions-left\">\n                        <div\n                            onClick={this.onClickOperationButton}\n                            className=\"player-controller-play\"\n                        >\n                            {this.operationButton()}\n                        </div>\n                        <div\n                            className=\"player-volume-box\"\n                            onMouseEnter={() => this.setState({ isVolumeHover: true })}\n                            onMouseLeave={() => this.setState({ isVolumeHover: false })}\n                        >\n                            <div onClick={this.handleClickVolume} className=\"player-volume\">\n                                {this.operationVolumeButton()}\n                            </div>\n                            <div className=\"player-volume-slider\">\n                                <SeekSlider\n                                    total={100}\n                                    current={100 * this.state.seekVolume}\n                                    onChange={this.onVolumeChange}\n                                    onSeekStart={this.onVolumeSeekStart}\n                                    onSeekEnd={this.onVolumeSeekEnd}\n                                    scale={this.props.scale}\n                                    limitTimeTooltipBySides\n                                    hideHoverTime\n                                />\n                            </div>\n                        </div>\n                    </div>\n                    <div className=\"player-mid-box-time\">\n                        {displayWatch(Math.floor(progressTime / 1000))} /{\" \"}\n                        {displayWatch(Math.floor(duration / 1000))}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction displayWatch(seconds: number): string {\n    const displaySeconds = seconds % 60;\n    const minutes = (seconds - displaySeconds) / 60;\n\n    if (minutes >= 60) {\n        const displayMinutes = minutes % 60;\n        const hours = (minutes - displayMinutes) / 60;\n\n        return `${updateNumber(hours)}:${updateNumber(displayMinutes)}:${updateNumber(\n            displaySeconds\n        )}`;\n    } else {\n        return `${updateNumber(minutes)}:${updateNumber(displaySeconds)}`;\n    }\n}\n\nfunction updateNumber(time: number): string {\n    if (time <= 9) {\n        return `0${time}`;\n    } else {\n        return `${time}`;\n    }\n}\n","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiBjbGFzcz0iaWNvbmlmeSBpY29uaWZ5LS1tZGkiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOCA1LjE0djE0bDExLTdsLTExLTd6IiBmaWxsPSIjZmZmIj48L3BhdGg+PC9zdmc+Cg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiBjbGFzcz0iaWNvbmlmeSBpY29uaWZ5LS1tZGkiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTQgMTloNFY1aC00TTYgMTloNFY1SDZ2MTR6IiBmaWxsPSIjZmZmIj48L3BhdGg+PC9zdmc+Cg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiBjbGFzcz0iaWNvbmlmeSBpY29uaWZ5LS1tZGkiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTQgMy4yM3YyLjA2YzIuODkuODYgNSAzLjU0IDUgNi43MXMtMi4xMSA1Ljg0LTUgNi43djIuMDdjNC0uOTEgNy00LjQ5IDctOC43N2MwLTQuMjgtMy03Ljg2LTctOC43N00xNi41IDEyYzAtMS43Ny0xLTMuMjktMi41LTQuMDNWMTZjMS41LS43MSAyLjUtMi4yNCAyLjUtNE0zIDl2Nmg0bDUgNVY0TDcgOUgzeiIgZmlsbD0iI2ZmZiI+PC9wYXRoPjwvc3ZnPgo=\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiBjbGFzcz0iaWNvbmlmeSBpY29uaWZ5LS1tZGkiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNNyA5djZoNGw1IDVWNGwtNSA1SDd6IiBmaWxsPSIjZmZmIj48L3BhdGg+PC9zdmc+Cg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBhcmlhLWhpZGRlbj0idHJ1ZSIgcm9sZT0iaW1nIiBjbGFzcz0iaWNvbmlmeSBpY29uaWZ5LS1tZGkiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNNSA5djZoNGw1IDVWNEw5IDltOS41IDNjMC0xLjc3LTEtMy4yOS0yLjUtNC4wM1YxNmMxLjUtLjcxIDIuNS0yLjI0IDIuNS00eiIgZmlsbD0iI2ZmZiI+PC9wYXRoPjwvc3ZnPgo=\"","import type { AppContext, Player, Room } from \"@netless/window-manager\";\n\nimport React, { Component } from \"react\";\nimport videojs from \"video.js\";\nimport type { VideoJsPlayer } from \"video.js\";\n\nimport { defaultAttributes, Version } from \"../constants\";\nimport { options } from \"../options\";\nimport type { Props, Attributes, Keys } from \"../types\";\nimport { AudioExts, checkWhiteWebSdkVersion, getCurrentTime, isSafari, nextFrame } from \"../utils\";\nimport PlayerController from \"./PlayerController\";\n\nexport class MediaPlayer extends Component<Props> {\n    render() {\n        const { context } = this.props;\n        const room = context.getRoom();\n        const player = room ? undefined : (context.getDisplayer() as Player);\n        const putAttributes = this.putAttributes;\n        return (\n            <MediaPlayerImpl\n                room={room}\n                player={player}\n                context={context}\n                plugin={{ putAttributes }}\n            />\n        );\n    }\n    putAttributes = (b: Partial<Attributes>) => {\n        const { context } = this.props;\n        const a = (context.getAttributes() || {}) as any;\n        for (const k in b) {\n            if (a[k] !== b[k as Keys]) {\n                context.updateAttributes([k], b[k as Keys]);\n            }\n        }\n    };\n}\n\nexport interface ImplProps {\n    room?: Room;\n    player?: Player;\n    context: AppContext<Attributes>;\n    plugin: { putAttributes(attrs: any): void };\n}\n\ninterface State {\n    NoSound: boolean;\n    MediaError: boolean;\n    updater: boolean;\n    controllerVisible: boolean;\n}\n\nclass MediaPlayerImpl extends Component<ImplProps, State> {\n    alertMask: HTMLDivElement | null = null;\n    container = React.createRef<HTMLDivElement>();\n    player: VideoJsPlayer | undefined;\n    controllerHiddenTimer = 0;\n    syncPlayerTimer = 0;\n    retryCount = 0;\n    decreaseRetryTimer = 0;\n    noSoundSyncCount = 0;\n\n    constructor(props: ImplProps) {\n        super(props);\n        this.state = {\n            NoSound: false,\n            MediaError: false,\n            updater: false,\n            controllerVisible: false,\n        };\n\n        props.room && checkWhiteWebSdkVersion(props.room);\n    }\n\n    getAttributes() {\n        const { context } = this.props;\n        let s = context.getAttributes();\n        if (!s) return;\n        s = { ...defaultAttributes, ...s };\n        // 如果 s.currentTime > player.duration()，说明线上的状态大概率是错了\n        if (this.player) {\n            let currentTime = getCurrentTime(s, this.props);\n            let duration = this.player.duration();\n            if (!s.paused && currentTime > duration) {\n                s = { ...s, currentTime: 0, paused: true };\n                this.resetPlayer();\n            }\n        }\n        return s;\n    }\n\n    isShowingPoster() {\n        const s = this.getAttributes();\n        if (!s?.src) return true;\n        return AudioExts.some(e => s.src.endsWith(e));\n    }\n\n    render() {\n        if (!(this.props.room || this.props.player)) {\n            return null;\n        }\n        const s = this.getAttributes();\n        if (!s) {\n            return null;\n        }\n        const duration = (this.player?.duration() || 1e3) * 1000;\n        const bufferedPercent = this.player?.bufferedPercent() || 0;\n\n        // const controllerVisible = this.state.isAudio || this.state.controllerVisible;\n        return (\n            <div\n                className={this.isEnabled() ? \"vjs-p\" : \"vjs-p disabled\"}\n                onMouseEnter={this.showController}\n                onMouseMove={this.showController}\n            >\n                <div className=\"video-js-plugin-player\" ref={this.container} />\n                {this.isShowingPoster() && (\n                    <div className=\"video-js-plugin-poster\">\n                        {s.poster && <img src={s.poster} alt=\"\" draggable={false} />}\n                    </div>\n                )}\n                <PlayerController\n                    duration={duration}\n                    volume={s.volume}\n                    setVolume={this.setVolume}\n                    paused={s.paused}\n                    play={this.play}\n                    pause={this.pause}\n                    currentTime={getCurrentTime(s, this.props) * 1000}\n                    setCurrentTime={this.setCurrentTime}\n                    buffered={duration * bufferedPercent}\n                    visible\n                />\n                {this.state.NoSound && (\n                    <div ref={this.setupAlert} className=\"videojs-plugin-muted-alert\" />\n                )}\n                {this.state.MediaError && (\n                    <div className=\"videojs-plugin-recovery-mode\">\n                        <button ref={this.setupReload}>Reload Player</button>\n                    </div>\n                )}\n            </div>\n        );\n    }\n\n    debug(msg: string, ...args: any[]) {\n        if (options.verbose) {\n            options.log(`[MediaPlayer] ${msg}`, ...args);\n        }\n    }\n\n    showController = () => {\n        this.setState({ controllerVisible: true });\n        this.debounceHidingController();\n    };\n\n    play = () => {\n        const hostTime = this.props.room?.calibrationTimestamp;\n        this.debug(\">>> play\", { paused: false, hostTime });\n        this.isEnabled() && this.props.plugin.putAttributes({ paused: false, hostTime });\n    };\n\n    pause = () => {\n        const currentTime = getCurrentTime(this.getAttributes()!, this.props);\n        this.debug(\">>> pause\", { paused: true, currentTime });\n        this.isEnabled() && this.props.plugin.putAttributes({ paused: true, currentTime });\n    };\n\n    setVolume = (volume: number) => {\n        this.debug(\">>> volume\", { volume });\n        this.isEnabled() && this.props.plugin.putAttributes({ volume });\n        this.isEnabled() && this.props.plugin.putAttributes({ volume, muted: volume === 0 });\n    };\n\n    setCurrentTime = (t: number) => {\n        const hostTime = this.props.room?.calibrationTimestamp;\n        this.debug(\">>> seek\", { currentTime: t / 1000, hostTime });\n        this.isEnabled() && this.props.plugin.putAttributes({ currentTime: t / 1000, hostTime });\n    };\n\n    resetPlayer = () => {\n        this.player?.autoplay(false);\n        // 如果此时处于异常状态, 此 ended 事件不会同步到其他端\n        if (!this.state.NoSound) {\n            this.debug(\">>> ended\", { paused: true, currentTime: 0 });\n            this.isEnabled() && this.props.plugin.putAttributes({ paused: true, currentTime: 0 });\n        }\n    };\n\n    componentDidMount() {\n        this.debug(\"app version =\", Version);\n        this.debug(\"video.js version =\", videojs.VERSION);\n        this.initPlayer();\n        this.props.context.emitter.on(\"attributesUpdate\", this.syncPlayerWithAttributes);\n        this.syncPlayerTimer = setInterval(this.syncPlayerWithAttributes, options.syncInterval);\n        this.decreaseRetryTimer = setInterval(this.decreaseRetryCount, options.retryInterval);\n    }\n\n    componentWillUnmount() {\n        this.debug(\"unmount\");\n        this.props.context.emitter.off(\"attributesUpdate\", this.syncPlayerWithAttributes);\n        this.player?.dispose();\n        clearInterval(this.syncPlayerTimer);\n        clearInterval(this.decreaseRetryTimer);\n    }\n\n    syncPlayerWithAttributes = () => {\n        const s = this.getAttributes();\n        if (!s) return;\n\n        const player = this.player;\n        if (!player) return;\n\n        // 如果此时处于异常状态，增加容错 (每 8 个 interval 同步一次)\n        if (this.state.NoSound && (this.noSoundSyncCount += 1) % 8 !== 0) {\n            return;\n        }\n\n        if (player.paused() !== s.paused) {\n            this.debug(\"<<< paused -> %o\", s.paused);\n            if (s.paused) {\n                player.pause();\n            } else {\n                player.play()?.catch(this.catchPlayFail);\n            }\n        }\n\n        // NOTE: 2 actions below will cause error message in console (ignore them)\n        if (player.muted() !== s.muted) {\n            this.debug(\"<<< muted -> %o\", s.muted);\n            player.muted(s.muted);\n        }\n\n        if (player.volume() !== s.volume) {\n            this.debug(\"<<< volume -> %o\", s.volume);\n            player.volume(s.volume);\n        }\n\n        const currentTime = getCurrentTime(s, this.props);\n        let maxError = options.currentTimeMaxError;\n        // 如果此时处于异常状态，增加同步时间的容错 (3 倍)\n        if (this.state.NoSound) {\n            maxError *= 3;\n        }\n        if (currentTime > player.duration()) {\n            this.resetPlayer();\n        } else if (Math.abs(player.currentTime() - currentTime) > maxError) {\n            this.debug(\"<<< currentTime -> %o\", currentTime);\n            player.currentTime(currentTime);\n        }\n    };\n\n    debounceHidingController = () => {\n        if (this.controllerHiddenTimer) {\n            clearTimeout(this.controllerHiddenTimer);\n            this.controllerHiddenTimer = 0;\n        }\n        this.controllerHiddenTimer = setTimeout(() => {\n            this.setState({ controllerVisible: false });\n            this.controllerHiddenTimer = 0;\n        }, 3000);\n    };\n\n    decreaseRetryCount = () => {\n        if (!this.player) return;\n        if (this.retryCount > 0) {\n            this.retryCount = this.retryCount - 1;\n        }\n    };\n\n    catchPlayFail = (err: Error) => {\n        const string = String(err);\n        if ((isSafari && string.includes(\"NotAllowedError\")) || string.includes(\"interact\")) {\n            this.player?.autoplay(\"any\");\n            this.setState({ NoSound: true });\n        } else {\n            const mediaError = this.player?.error();\n            if (mediaError) {\n                if (this.retryCount <= 3) {\n                    this.initPlayer();\n                    this.retryCount = this.retryCount + 1;\n                } else {\n                    this.debug(\"catch videojs media error\", mediaError);\n                    this.setState({ MediaError: true });\n                }\n            }\n            this.debug(\"catch error\", err);\n        }\n    };\n\n    fixPlayFail = () => {\n        this.debug(\"try to fix play state\");\n        this.setState({ NoSound: false });\n        const { muted, volume } = this.getAttributes()!;\n        if (this.player) {\n            this.player.muted(muted);\n            this.player.volume(volume);\n        }\n    };\n\n    initPlayer = async () => {\n        this.player?.dispose();\n        this.player = undefined;\n\n        this.debug(\"creating elements ...\");\n        const { type, src, poster } = this.getAttributes()!;\n\n        const wrapper = document.createElement(\"div\");\n        wrapper.setAttribute(\"data-vjs-player\", \"\");\n\n        const video = document.createElement(\"video\");\n        video.className = \"video-js\";\n        poster && (video.poster = poster);\n\n        video.setAttribute(\"playsInline\", \"\");\n        video.setAttribute(\"webkit-playsinline\", \"\");\n\n        const source = document.createElement(\"source\");\n        if (new URL(src).pathname.endsWith(\".m3u8\")) {\n            source.type = \"application/x-mpegURL\";\n        } else {\n            video.src = src;\n        }\n        source.src = src;\n        type && (source.type = type);\n\n        video.appendChild(source);\n        wrapper.appendChild(video);\n        this.container.current!.appendChild(wrapper);\n\n        // NOTE: don't remove this line!\n        await nextFrame();\n\n        this.debug(\"initializing videojs() ...\");\n        const player = videojs(video);\n        this.player = player;\n        (window as any).player = player;\n\n        player.one(\"loadedmetadata\", this.gracefullyUpdate);\n\n        player.on(\"ready\", () => {\n            options.onPlayer?.(player);\n\n            player.on(\"timeupdate\", this.gracefullyUpdate);\n            player.on(\"volumechange\", this.gracefullyUpdate);\n            player.on(\"seeked\", this.gracefullyUpdate);\n            player.on(\"play\", this.gracefullyUpdate);\n            player.on(\"pause\", this.gracefullyUpdate);\n            player.on(\"ended\", this.resetPlayer);\n        });\n\n        player.on(\"error\", this.catchPlayFail);\n\n        this.setState({ MediaError: false });\n    };\n\n    gracefullyUpdate = () => this.setState({ updater: !this.state.updater });\n\n    setupAlert = (element: HTMLDivElement | null) => {\n        if (element) {\n            element.addEventListener(\"touchstart\", this.fixPlayFail);\n            element.addEventListener(\"click\", this.fixPlayFail);\n        }\n        this.alertMask = element;\n    };\n\n    setupReload = (element: HTMLButtonElement | null) => {\n        if (element) {\n            element.addEventListener(\"touchstart\", this.initPlayer);\n            element.addEventListener(\"click\", this.initPlayer);\n        }\n    };\n\n    isEnabled() {\n        return this.props.context.getIsWritable();\n    }\n}\n","import type { NetlessApp } from \"@netless/window-manager\";\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { MediaPlayer } from \"./components/MediaPlayer\";\n\nimport styles from \"./style.css?inline\";\n\nimport { defaultAttributes, Kind } from \"./constants\";\nimport type { Attributes } from \"./types\";\n\nexport { setOptions } from \"./options\";\nexport type { MediaPlayerOptions } from \"./options\";\nexport { Version } from \"./constants\";\nexport type { Attributes as NetlessAppMediaPlayerAttributes };\n\nconst NetlessAppMediaPlayer: NetlessApp<Attributes> = {\n    kind: Kind,\n    setup(context) {\n        let attrs = context.getAttributes();\n        if (!attrs || !attrs.src) {\n            return context.emitter.emit(\"destroy\", {\n                error: new Error(`[MediaPlayer]: Missing 'attributes'.'src'.`),\n            });\n        }\n        attrs = { ...defaultAttributes, ...attrs };\n\n        const box = context.getBox();\n        box.mountStyles(styles);\n\n        const container = document.createElement(\"div\");\n        container.classList.add(\"netless-app-media-player-container\");\n        ReactDOM.render(<MediaPlayer context={context} />, container);\n\n        box.mountContent(container);\n\n        context.emitter.on(\"destroy\", () => {\n            console.log(\"[MediaPlayer]: destroy\");\n            ReactDOM.unmountComponentAtNode(container);\n        });\n    },\n};\n\nexport default NetlessAppMediaPlayer;\n"],"names":["defaultAttributes","src","currentTime","hostTime","muted","paused","volume","defaultOptions","currentTimeMaxError","syncInterval","retryInterval","verbose","log","console","bind","options","attributes","props","now2","player","beginTimestamp","progressTime","room","calibrationTimestamp","getTimestamp","isSafari","navigator","userAgent","includes","AudioExts","global","Object","freeSelf","self","freeGlobal","Function","root","Symbol","objectProto","prototype","hasOwnProperty","nativeObjectToString","toString","symToStringTag","toStringTag","value","isOwn","call","tag","unmasked","e","result","getRawTag","objectToString","reWhitespace","reTrimStart","string","slice","index","length","test","charAt","trimmedEndIndex","replace","type","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","isObjectLike","baseGetTag","isSymbol","isObject","other","valueOf","baseTrim","isBinary","Date","now","nativeMax","Math","max","nativeMin","min","func","wait","options2","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","TypeError","time","args","thisArg","apply","setTimeout","timerExpired","invokeFunc","timeSinceLastCall","shouldInvoke","trailingEdge","timeWaiting","remainingWait","isInvoking","arguments","this","leadingEdge","toNumber","cancel","flush","debounced","Component","constructor","event","pageX","i","changedTouches","mobileSeeking","changeCurrentTimePosition","evt","seeking","track","setState","trackWidth","offsetWidth","clear","scale","position","getBoundingClientRect","left","seekHoverPosition","setSeeking","onMouseUp","state","preventDefault","handleSeeking","setMobileSeeking","buffered","style","__spreadValues","getPositionStyle","bufferColor","backgroundColor","className","current","sliderColor","getSeekHoverPosition","sliderHoverColor","isThumbActive","getThumbHandlerPosition","thumbColor","pause","seekPause","onSeekStart","play","onSeekEnd","secondsPrefix","minutesPrefix","ready","componentDidMount","setTrackWidthState","addEventListener","mouseSeekingHandler","handleTouchSeeking","mobileTouchSeekingHandler","componentWillUnmount","removeEventListener","total","toFixed","onChange","transform","getHoverTimePosition","hoverTime","limitTimeTooltipBySides","secondsToTime","seconds","round","offset","hours","floor","divForMinutes","minutes","sec","ceil","hh","mm","ss","getHoverTime","percent","times","drawHoverTime","hideHoverTime","ref","render","onMouseMove","handleTrackHover","onMouseLeave","onMouseDown","onTouchStart","onTouchEnd","renderBufferProgress","renderHoverProgress","renderProgress","renderThumb","stageVolume","setVolume","changeTime","debounce","setCurrentTime","changeVolume","seekVolume","onVolumeSeeking","isPlayerSeeking","isVolumeHover","visible","updateVolumeTimer","setInterval","duration","opacity","SeekSlider","onProgressSeekStart","onProgressSeekEnd","onClick","onClickOperationButton","operationButton","onMouseEnter","handleClickVolume","operationVolumeButton","onVolumeChange","onVolumeSeekStart","onVolumeSeekEnd","displayWatch","displaySeconds","displayMinutes","updateNumber","b","context","a","getAttributes","k","updateAttributes","getRoom","getDisplayer","putAttributes","MediaPlayerImpl","plugin","React","createRef","controllerVisible","debounceHidingController","debug","isEnabled","getCurrentTime","t","autoplay","NoSound","s","noSoundSyncCount","catch","catchPlayFail","maxError","resetPlayer","abs","controllerHiddenTimer","retryCount","err","String","mediaError","error","initPlayer","MediaError","async","dispose","poster","wrapper","document","createElement","setAttribute","video","source","URL","pathname","endsWith","appendChild","container","Promise","requestAnimationFrame","window","r","videojs","one","gracefullyUpdate","on","onPlayer","updater","element","fixPlayFail","alertMask","Error","checkWhiteWebSdkVersion","isShowingPoster","some","bufferedPercent","showController","alt","draggable","PlayerController","setupAlert","setupReload","msg","VERSION","emitter","syncPlayerWithAttributes","syncPlayerTimer","decreaseRetryTimer","decreaseRetryCount","off","getIsWritable","NetlessAppMediaPlayer","kind","setup","attrs","emit","box","getBox","mountStyles","classList","add","MediaPlayer","mountContent","unmountComponentAtNode","userDefined"],"mappings":"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"}