module.exports=function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}({"./src/CombinePlayerImplement.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var a=n("@babel/runtime/regenerator"),i=n.n(a),r=n("@babel/runtime/helpers/asyncToGenerator"),s=n.n(r),u=n("@babel/runtime/helpers/classCallCheck"),o=n.n(u),c=n("@babel/runtime/helpers/createClass"),h=n.n(c),d=function(e,t,n){"string"==typeof n?console.log("[Combine-Player][".concat(e,"]: ").concat(t," -"),n):console.log("[Combine-Player][".concat(e,"]: ").concat(t," -"),JSON.stringify(n,null,2))},f=n("./src/StatusContant.ts"),l=n("./src/EventEmitter.ts"),b=n("./src/ErrorConstant.ts");function p(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw r}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var g=function(){function e(t){o()(this,e),this.videoStatus={current:f.b.PauseBuffering,previous:f.b.PauseBuffering},this.whiteboardStatus={current:f.b.PauseBuffering,previous:f.b.PauseBuffering},this.statusLockInfo={isLocked:!1,allowStatusList:[],unLockStatusList:[]},this.events=new l.a,this.table=void 0,this.debug=function(){},this.statusIgnoreCrashByDisabled=[],this.statusIgnoreCrashByDisabledCallback=function(){return Promise.resolve()},t&&(this.debug=d),this.table=this.initTables()}var t;return h()(e,[{key:"one",value:function(e,t){var n=this;return new Promise((function(a,r){n.events.one(e,function(){var e=s()(i.a.mark((function e(n,s,u){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t){e.next=4;break}return e.next=4,t({previous:n,current:s});case 4:a(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r(e.t0);case 10:return e.prev=10,u(),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,7,10,13]])})));return function(t,n,a){return e.apply(this,arguments)}}())}))}},{key:"setOnCrashByDisabledStatus",value:(t=s()(i.a.mark((function e(t){var n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.on(f.c.Disabled,function(){var e=s()(i.a.mark((function e(a){var r,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.current,s=r.video,u=r.whiteboard,n.shouldCrash(s,u)&&t();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"oneButNotCrashByDisabled",value:function(e,t){var n=this;return new Promise((function(a,r){if(0!==n.statusIgnoreCrashByDisabled.length)return r(new Error(b.f));n.statusIgnoreCrashByDisabled.push(e);var u=function(){var e=s()(i.a.mark((function e(s,u,o){var c,h;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.getStatus(f.a.Whiteboard).current,h=n.getStatus(f.a.Video).current,!!n.shouldCrash(h,c)){e.next=13;break}if(n.statusIgnoreCrashByDisabled=[],n.statusIgnoreCrashByDisabledCallback=function(){return Promise.resolve()},o(),a(),!t){e.next=11;break}return e.next=11,t({previous:s,current:u});case 11:e.next=14;break;case 13:r(new Error(b.a));case 14:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();n.statusIgnoreCrashByDisabledCallback=u,n.events.one(f.c.Disabled,u)}))}},{key:"cancelOneButNotCrashByDisabled",value:function(){this.events.removeListener(f.c.Disabled,this.statusIgnoreCrashByDisabledCallback),this.statusIgnoreCrashByDisabled=[],this.statusIgnoreCrashByDisabledCallback=function(){return Promise.resolve()}}},{key:"on",value:function(e,t){var n=this;return new Promise((function(a,r){n.events.addListener(e,function(){var e=s()(i.a.mark((function e(n,s,u){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t({previous:n,current:s});case 3:a(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),r(e.t0);case 9:return e.prev=9,u(),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[0,6,9,12]])})));return function(t,n,a){return e.apply(this,arguments)}}())}))}},{key:"off",value:function(e){if("string"==typeof e)this.events.removeAllListener(e);else for(var t=0;t<e.length;t++)this.events.removeAllListener(e[t])}},{key:"destroy",value:function(){this.events.destroy(),this.unlockCombineStatus()}},{key:"setStatus",value:function(e,t){switch(e){case f.a.Video:if(this.videoStatus.current===t)return;this.videoStatus.current=t,this.debug("Single","Video",f.b[t]);break;case f.a.Whiteboard:if(this.whiteboardStatus.current===t)return;this.whiteboardStatus.current=t,this.debug("Single","Whiteboard",f.b[t])}var n=this.whiteboardStatus.current,a=this.videoStatus.current,i=this.table[n][a];this.statusLockInfo.isLocked?this.statusLockInfo.allowStatusList.includes(i.combineStatus)&&(this.statusLockInfo.unLockStatusList.includes(i.combineStatus)&&this.unlockCombineStatus(),this.dispatchEvent(i)):this.dispatchEvent(i)}},{key:"lockCombineStatus",value:function(e,t){this.statusLockInfo.isLocked||(this.statusLockInfo.isLocked=!0,this.statusLockInfo.allowStatusList=e,this.statusLockInfo.unLockStatusList=t)}},{key:"getCombinationStatus",value:function(){var e=this.videoStatus,t=e.previous,n=e.current,a=this.whiteboardStatus,i=a.previous,r=a.current;return{previous:this.table[i][t].combineStatus,current:this.table[r][n].combineStatus}}},{key:"getStatus",value:function(e){switch(e){case f.a.Video:return{previous:this.videoStatus.previous,current:this.videoStatus.current};case f.a.Whiteboard:return{previous:this.whiteboardStatus.previous,current:this.whiteboardStatus.current}}}},{key:"shouldCrash",value:function(e,t){var n,a=!1,i=p(this.statusIgnoreCrashByDisabled[0]);try{for(i.s();!(n=i.n()).done;){var r=n.value,s=r.video;if(t===r.whiteboard&&s===e){a=!0;break}}}catch(e){i.e(e)}finally{i.f()}return!a}},{key:"unlockCombineStatus",value:function(){this.statusLockInfo.isLocked=!1,this.statusLockInfo.allowStatusList=[],this.statusLockInfo.unLockStatusList=[]}},{key:"setPreviousStatus",value:function(e,t){this.whiteboardStatus.previous=e,this.videoStatus.previous=t}},{key:"dispatchEvent",value:function(e){var t=this,n=e.videoStatus,a=e.whiteboardStatus,i=e.combineStatus,r={whiteboard:this.getStatus(f.a.Whiteboard).previous,video:this.getStatus(f.a.Video).previous},s={whiteboard:a,video:n};this.debug("CombinedStatus",i,{previous:{whiteboard:f.b[r.whiteboard],video:f.b[r.video]},current:{whiteboard:f.b[s.whiteboard],video:f.b[s.video]}});this.events.emit(i,r,s,(function(){t.setPreviousStatus(a,n)}))}},{key:"initTables",value:function(){var e=function(e){return function(t,n){return Object.freeze({combineStatus:e,whiteboardStatus:t,videoStatus:n})}},t=e(f.c.PauseSeeking),n=e(f.c.PlayingSeeking),a=e(f.c.PauseBuffering),i=e(f.c.PlayingBuffering),r=e(f.c.ToPlay),s=e(f.c.ToPause),u=e(f.c.Pause),o=e(f.c.Playing),c=e(f.c.Disabled),h=e(f.c.Ended);return Object.freeze([Object.freeze([t(f.b.PauseSeeking,f.b.PauseSeeking),t(f.b.PauseSeeking,f.b.Pause),c(f.b.PauseSeeking,f.b.PauseBuffering),c(f.b.PauseSeeking,f.b.PlayingBuffering),c(f.b.PauseSeeking,f.b.Playing),c(f.b.PauseSeeking,f.b.PlayingSeeking),t(f.b.PauseSeeking,f.b.Ended)]),Object.freeze([t(f.b.Pause,f.b.PauseSeeking),u(f.b.Pause,f.b.Pause),a(f.b.Pause,f.b.PauseBuffering),i(f.b.Pause,f.b.PlayingBuffering),r(f.b.Pause,f.b.Playing),n(f.b.Pause,f.b.PlayingSeeking),h(f.b.Pause,f.b.Ended)]),Object.freeze([c(f.b.PauseBuffering,f.b.PauseSeeking),a(f.b.PauseBuffering,f.b.Pause),a(f.b.PauseBuffering,f.b.PauseBuffering),c(f.b.PauseBuffering,f.b.PlayingBuffering),c(f.b.PauseBuffering,f.b.Playing),c(f.b.PauseBuffering,f.b.PlayingSeeking),c(f.b.PauseBuffering,f.b.Ended)]),[c(f.b.PlayingBuffering,f.b.PauseSeeking),i(f.b.PlayingBuffering,f.b.Pause),c(f.b.PlayingBuffering,f.b.PauseBuffering),i(f.b.PlayingBuffering,f.b.PlayingBuffering),s(f.b.PlayingBuffering,f.b.Playing),c(f.b.PlayingBuffering,f.b.PlayingSeeking),c(f.b.PlayingBuffering,f.b.Ended)],Object.freeze([c(f.b.Playing,f.b.PauseSeeking),r(f.b.Playing,f.b.Pause),c(f.b.Playing,f.b.PauseBuffering),s(f.b.Playing,f.b.PlayingBuffering),o(f.b.Playing,f.b.Playing),s(f.b.Playing,f.b.PlayingSeeking),s(f.b.Playing,f.b.Ended)]),Object.freeze([c(f.b.PlayingSeeking,f.b.PauseSeeking),n(f.b.PlayingSeeking,f.b.Pause),c(f.b.PlayingSeeking,f.b.PauseBuffering),c(f.b.PlayingSeeking,f.b.PlayingBuffering),s(f.b.PlayingSeeking,f.b.Playing),n(f.b.PlayingSeeking,f.b.PlayingSeeking),n(f.b.PlayingSeeking,f.b.Ended)]),Object.freeze([t(f.b.Ended,f.b.PauseSeeking),h(f.b.Ended,f.b.Pause),c(f.b.Ended,f.b.PauseBuffering),c(f.b.Ended,f.b.PlayingBuffering),s(f.b.Ended,f.b.Playing),n(f.b.Ended,f.b.PlayingSeeking),h(f.b.Ended,f.b.Ended)])])}}]),e}(),y=function(){function e(){o()(this,e),this.queue=[],this.isHanding=!1}var t;return h()(e,[{key:"append",value:function(e){var t=this;return new Promise((function(n,a){var i={handler:e,resolve:n,reject:a};t.queue.push(i),t.isHanding||t.startHandingTasksLoop()}))}},{key:"destroy",value:function(){this.queue=[]}},{key:"startHandingTasksLoop",value:(t=s()(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.isHanding=!0;case 2:if(!(this.queue.length>0)){e.next=20;break}return t=this.queue[0],e.prev=4,e.t0=t,e.next=8,t.handler();case 8:e.t1=e.sent,e.t0.resolve.call(e.t0,e.t1),e.next=15;break;case 12:e.prev=12,e.t2=e.catch(4),t.reject(e.t2);case 15:return e.prev=15,this.queue.shift(),e.finish(15);case 18:e.next=2;break;case 20:e.next=25;break;case 22:throw e.prev=22,e.t3=e.catch(0),new Error(e.t3);case 25:return e.prev=25,this.isHanding=!1,e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[0,22,25,28],[4,12,15,18]])}))),function(){return t.apply(this,arguments)})}]),e}(),P=function(){function e(t){o()(this,e),this.video=void 0,this.whiteboard=void 0,this.videoOptions=void 0,this.stateMachine=void 0,this._playbackRate=1,this.seekTime=NaN,this.triggerSource=f.e.None,this.currentCombineStatus=f.d.PauseBuffering,this.whiteboardEmitter=void 0,this.taskQueue=new y,this.onStatusChangeHandleList=[];var n=t.videoConfig,a=t.whiteboard,i=t.whiteboardEmitter,r=t.debug;this.videoOptions=n.videoOptions,this.video=n.video,this.whiteboard=a,this.whiteboardEmitter=i,this.stateMachine=new g(r),this.initOnCrashByDisabledStatusCallback(),this.initVideo(n.isCanplay),this.initWhiteboard()}var t,n,a,r,u,c,d,l,p,v,P,k,m,w,S,E,x,M,B;return h()(e,[{key:"setOnStatusChange",value:function(e){this.onStatusChangeHandleList.push(e)}},{key:"removeStatusChange",value:function(e){this.onStatusChangeHandleList=this.onStatusChangeHandleList.filter((function(t){return t!==e}))}},{key:"removeAllStatusChange",value:function(){this.onStatusChangeHandleList=[]}},{key:"getStatus",value:function(){return this.combinedStatus}},{key:"playbackSpeed",value:function(e){this.playbackRate=e}},{key:"stop",value:function(){if(this.currentCombineStatus===f.d.Stopped)throw new Error(b.d);if(this.currentCombineStatus===f.d.Disabled)throw new Error(b.c);this.releaseEvents(),this.onStatusUpdate(f.d.Stopped)}},{key:"play",value:(B=s()(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNotResponse()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.taskQueue.append(s()(i.a.mark((function e(){var n,a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.triggerSource=f.e.Plugin,e.next=3,t.checkVideoAutoPlay();case 3:if(e.sent){e.next=8;break}return console.error("[Combine-Player]: does not support auto play"),t.triggerSource=f.e.None,e.abrupt("return");case 8:n=t.stateMachine.getCombinationStatus().current,e.t0=n,e.next=e.t0===f.c.Pause?12:e.t0===f.c.PauseBuffering?15:e.t0===f.c.Ended?31:34;break;case 12:return e.next=14,t.playWhenPause();case 14:return e.abrupt("break",34);case 15:if(a=t.stateMachine.getStatus(f.a.Video).current,r=t.stateMachine.getStatus(f.a.Whiteboard).current,a!==f.b.Pause||r!==f.b.PauseBuffering){e.next=22;break}return e.next=20,t.playWhenVideoIsPauseAndWhiteboardIsPauseBuffering();case 20:e.next=30;break;case 22:if(a!==f.b.PauseBuffering||r!==f.b.Pause){e.next=28;break}return t.onStatusUpdate(f.d.PlayingBuffering),e.next=26,t.playWhenPause();case 26:e.next=30;break;case 28:return e.next=30,t.playWhenAllPlayerIsPauseBuffering();case 30:return e.abrupt("break",34);case 31:return e.next=33,t.playWhenEnded();case 33:return e.abrupt("break",34);case 34:if(isNaN(t.seekTime)){e.next=38;break}return e.next=37,t.seekWhenPlaying(t.seekTime);case 37:t.seekTime=NaN;case 38:t.triggerSource=f.e.None;case 39:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"pause",value:(M=s()(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNotResponse()){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",this.taskQueue.append(s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.triggerSource=f.e.Plugin,t.stateMachine.getCombinationStatus().current!==f.c.Playing){e.next=5;break}return e.next=5,t.pauseWhenPlaying();case 5:t.triggerSource=f.e.None;case 6:case"end":return e.stop()}}),e)})))));case 3:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"seek",value:(x=s()(i.a.mark((function e(t){var n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNotResponse()){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",this.taskQueue.append(s()(i.a.mark((function e(){var a,r,s,u,o,c,h,d,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.whiteboard.progressTime,r=n.video.currentTime(),0!==a||0!==r){e.next=5;break}return 0!==t&&(n.seekTime=t),e.abrupt("return");case 5:n.triggerSource=f.e.Plugin,s=n.stateMachine.getCombinationStatus().current,e.t0=s,e.next=e.t0===f.c.Playing?10:e.t0===f.c.Pause||e.t0===f.c.PauseBuffering?13:e.t0===f.c.Ended?23:30;break;case 10:return e.next=12,n.seekWhenPlaying(t);case 12:return e.abrupt("break",30);case 13:if(u=n.getPlayerDuration(),o=u.video,c=u.whiteboard,!(t>o||t>c)){e.next=20;break}return e.next=18,n.seekWhenPauseFinallyIsEnded(t,u);case 18:e.next=22;break;case 20:return e.next=22,n.seekWhenPause(t);case 22:return e.abrupt("break",30);case 23:if(h=n.getPlayerDuration(),d=h.video,l=h.whiteboard,!(t<=d&&t<=l)){e.next=29;break}return e.next=27,n.seekWhenPause(t);case 27:return e.next=29,n.playWhenPause();case 29:return e.abrupt("break",30);case 30:n.triggerSource=f.e.None;case 31:case"end":return e.stop()}}),e)})))));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"initVideo",value:function(e){this.stateMachine.setStatus(f.a.Video,e?f.b.Pause:f.b.PauseBuffering),e||(this.currentCombineStatus=f.d.PauseBuffering),this.initVideoJSEvents()}},{key:"initVideoJSEvents",value:function(){var e=this,t=!1,n=function(t){return s()(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.triggerSource!==f.e.None&&e.triggerSource!==f.e.Video){n.next=4;break}return e.triggerSource=f.e.Video,n.next=4,t();case 4:case"end":return n.stop()}}),n)})))};this.video.on("canplay",(function(){var t=e.stateMachine.getStatus(f.a.Whiteboard).current;e.stateMachine.getStatus(f.a.Video).current===f.b.PauseBuffering&&(e.stateMachine.setStatus(f.a.Video,f.b.Pause),t===f.b.Pause&&e.onStatusUpdate(f.d.Pause))})),this.video.on("seeking",n(s()(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.taskQueue.append((function(){t=!0}));case 2:case"end":return n.stop()}}),n)}))))),this.video.on("waiting",n(s()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.onStatusUpdate(f.d.PlayingBuffering),t.next=3,e.taskQueue.append((function(){return e.pauseWhiteboardWhenVideoWaiting()}));case 3:e.triggerSource=f.e.None;case 4:case"end":return t.stop()}}),t)}))))),this.video.on("playing",n(s()(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.taskQueue.append(s()(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=2;break}return n.abrupt("return",e.playingWhiteboardWhenVideoPlayingDropFrame());case 2:return n.abrupt("return",e.playingWhiteboardWhenVideoPlaying());case 3:case"end":return n.stop()}}),n)}))));case 2:t=!1,e.triggerSource=f.e.None;case 4:case"end":return n.stop()}}),n)}))))),this.video.on("ended",n(s()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.taskQueue.append((function(){return e.pauseWhiteboardWhenVideoEnded()}));case 2:e.triggerSource=f.e.None;case 3:case"end":return t.stop()}}),t)}))))),this.video.on("fullscreenchange",n(s()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.taskQueue.append((function(){var t=e.stateMachine.getStatus(f.a.Video).current;t!==f.b.Playing&&t!==f.b.PlayingBuffering||!e.video.isFullscreen()&&e.video.paused()&&(e.whiteboardEmitter.one("pause",(function(){e.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause),e.stateMachine.setStatus(f.a.Video,f.b.Pause),e.onStatusUpdate(f.d.Pause)})),e.whiteboard.pause()),e.triggerSource=f.e.None}));case 2:case"end":return t.stop()}}),t)})))))}},{key:"initWhiteboard",value:function(){this.initWhiteboardIsPlayable(),this.initWhiteboardEvents(),this.stateMachine.setStatus(f.a.Whiteboard,f.b.PauseBuffering),this.currentCombineStatus=f.d.PauseBuffering,this.whiteboard.seekToProgressTime(0)}},{key:"initWhiteboardIsPlayable",value:function(){var e=this;this.whiteboardEmitter.addListener("playableChange",(function(t){var n=e.stateMachine.getStatus(f.a.Whiteboard).current,a=e.stateMachine.getStatus(f.a.Video).current;t&&n===f.b.PauseBuffering&&(e.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause),a===f.b.Pause&&e.onStatusUpdate(f.d.Pause))}))}},{key:"initWhiteboardEvents",value:function(){var e=this,t=function(t){return s()(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.triggerSource!==f.e.None&&e.triggerSource!==f.e.Whiteboard){n.next=5;break}return e.triggerSource=f.e.Whiteboard,n.next=4,t();case 4:e.triggerSource=f.e.None;case 5:case"end":return n.stop()}}),n)})))};this.whiteboardEmitter.addListener("buffering",t(s()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.taskQueue.append((function(){return e.pauseVideoWhenWhiteboardBuffering()}));case 2:case"end":return t.stop()}}),t)}))))),this.whiteboardEmitter.addListener("playing",t(s()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.taskQueue.append((function(){return e.playingVideoWhenWhiteboardPlaying()}));case 2:case"end":return t.stop()}}),t)}))))),this.whiteboardEmitter.addListener("ended",t(s()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.taskQueue.append((function(){return e.pauseVideoWhenWhiteboardEnded()}));case 2:case"end":return t.stop()}}),t)})))))}},{key:"playWhenPause",value:(E=s()(i.a.mark((function e(){var t,n,a,r,u=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stateMachine.lockCombineStatus([f.c.ToPlay,f.c.Playing],[f.c.Playing]),t=function(){u.stateMachine.setStatus(f.a.Video,f.b.Playing)},n=function(){u.stateMachine.setStatus(f.a.Whiteboard,f.b.Playing)},this.whiteboardEmitter.one("playing",n),a=this.stateMachine.one(f.c.ToPlay,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u.whiteboard.play();case 1:case"end":return e.stop()}}),e)})))),r=this.stateMachine.one(f.c.Playing,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u.onStatusUpdate(f.d.Playing);case 1:case"end":return e.stop()}}),e)})))),this.video.one("playing",t),this.video.play(),e.next=10,Promise.all([a,r]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"playWhenVideoIsPauseAndWhiteboardIsPauseBuffering",value:(S=s()(i.a.mark((function e(){var t,n,a,r,u,o,c,h,d,l=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stateMachine.lockCombineStatus([f.c.Disabled,f.c.Pause,f.c.PauseBuffering,f.c.ToPlay,f.c.Playing],[f.c.Playing]),t=function(){l.stateMachine.setStatus(f.a.Video,f.b.Playing)},n=function(){l.stateMachine.setStatus(f.a.Video,f.b.Pause)},a=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.PlayingBuffering)},r=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.Playing)},u=function(){l.whiteboardEmitter.removeListener("playing",r),l.whiteboardEmitter.removeListener("buffering",a),l.video.off("playing",t),l.video.off("pause",n)},this.stateMachine.oneButNotCrashByDisabled([{video:f.b.Playing,whiteboard:f.b.PauseBuffering}],s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.video.pause();case 1:case"end":return e.stop()}}),e)})))).catch((function(e){throw Error(e)})),o=this.stateMachine.one(f.c.PauseBuffering,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.whiteboard.play();case 1:case"end":return e.stop()}}),e)})))),c=this.stateMachine.one(f.c.Pause,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.whiteboard.play();case 1:case"end":return e.stop()}}),e)})))),h=this.stateMachine.one(f.c.ToPlay,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.video.play();case 1:case"end":return e.stop()}}),e)})))),d=this.stateMachine.one(f.c.Playing,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.onStatusUpdate(f.d.Playing),l.stateMachine.off([f.c.PauseBuffering,f.c.Pause,f.c.ToPlay]),u();case 3:case"end":return e.stop()}}),e)})))),this.whiteboardEmitter.one("buffering",a),this.whiteboardEmitter.one("playing",r),this.video.on("playing",t),this.video.one("pause",n),this.video.play(),e.next=18,Promise.all([Promise.race([o,c]),h,d]);case 18:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"playWhenAllPlayerIsPauseBuffering",value:(w=s()(i.a.mark((function e(){var t,n,a,r,u,o,c,h,d,l=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stateMachine.lockCombineStatus([f.c.Disabled,f.c.ToPause,f.c.ToPlay,f.c.Playing],[f.c.Playing]),t=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.PlayingBuffering)},n=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.Playing)},a=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause)},r=function(){l.stateMachine.setStatus(f.a.Video,f.b.Playing)},u=function(){l.stateMachine.setStatus(f.a.Video,f.b.PlayingBuffering)},o=function(){l.stateMachine.setStatus(f.a.Video,f.b.Pause)},this.stateMachine.oneButNotCrashByDisabled([{video:f.b.PlayingBuffering,whiteboard:f.b.PauseBuffering},{video:f.b.PauseBuffering,whiteboard:f.b.PlayingBuffering}],s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.stateMachine.oneButNotCrashByDisabled([{video:f.b.Playing,whiteboard:f.b.PauseBuffering},{video:f.b.PauseBuffering,whiteboard:f.b.Playing}],function(){var e=s()(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=t.current).video===f.b.Playing?l.video.pause():n.whiteboard===f.b.Playing&&l.whiteboard.pause();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){throw Error(e)}));case 1:case"end":return e.stop()}}),e)})))).catch((function(e){throw Error(e)})),c=this.stateMachine.one(f.c.ToPause,function(){var e=s()(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.current.video===f.b.Playing?l.video.pause():l.whiteboard.pause();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),h=this.stateMachine.one(f.c.ToPlay,function(){var e=s()(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.current.video===f.b.Playing?l.whiteboard.play():l.video.play();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),d=this.stateMachine.one(f.c.Playing,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.onStatusUpdate(f.d.Playing),l.stateMachine.cancelOneButNotCrashByDisabled(),l.stateMachine.off([f.c.ToPause,f.c.ToPlay]),l.video.off("playing",r),l.whiteboardEmitter.removeListener("playing",n),l.whiteboardEmitter.removeListener("pause",a);case 6:case"end":return e.stop()}}),e)})))),this.whiteboardEmitter.one("buffering",t),this.whiteboardEmitter.addListener("playing",n),this.whiteboardEmitter.one("pause",a),this.video.on("playing",r),this.video.one("play",u),this.video.one("pause",o),this.video.play(),this.whiteboard.play(),e.next=21,Promise.all([Promise.race([c,h]),d]);case 21:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"playWhenEnded",value:(m=s()(i.a.mark((function e(){var t,n,a,r,u,o,c,h,d,l=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.onStatusUpdate(f.d.PlayingBuffering),t=NaN,this.stateMachine.lockCombineStatus([f.c.Pause],[f.c.Pause]),n=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.PauseSeeking)},a=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause)},r=function(){l.whiteboard.pause()},u=function(){l.video.off("pause",o),l.video.off("play",c),l.video.one("play",(function(){l.video.one("pause",(function(){l.stateMachine.setStatus(f.a.Video,f.b.Pause)})),l.video.pause()})),l.video.play()},o=function(){l.video.play()},c=function(){l.video.pause()},h=function(){l.stateMachine.setStatus(f.a.Video,f.b.PauseSeeking),t=window.setInterval((function(){l.video.readyState()>=f.f.HAVE_CURRENT_DATA&&(clearInterval(t),l.video.play())}),500)},d=this.stateMachine.one(f.c.Pause,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.whiteboardEmitter.removeListener("buffering",n),l.whiteboardEmitter.removeListener("playing",r),clearInterval(t),e.next=5,l.playWhenPause();case 5:case"end":return e.stop()}}),e)})))),this.whiteboardEmitter.one("buffering",n),this.whiteboardEmitter.one("pause",a),this.whiteboardEmitter.one("playing",r),this.video.one("seeking",h),this.video.one("seeked",u),this.video.on("play",c),this.video.on("pause",o),this.whiteboard.seekToProgressTime(0),this.video.currentTime(0),e.next=22,d;case 22:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"pauseWhenPlaying",value:(k=s()(i.a.mark((function e(){var t,n,a,r=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stateMachine.lockCombineStatus([f.c.Pause],[f.c.Pause]),t=function(){r.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause)},n=function(){r.stateMachine.setStatus(f.a.Video,f.b.Pause)},a=this.stateMachine.one(f.c.Pause,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.onStatusUpdate(f.d.Pause);case 1:case"end":return e.stop()}}),e)})))),this.whiteboardEmitter.one("pause",t),this.video.one("pause",n),this.whiteboard.pause(),this.video.pause(),e.next=10,a;case 10:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"seekWhenPlaying",value:(P=s()(i.a.mark((function e(t){var n,a,r,u,o,c,h,d,l,b,p,v=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.onStatusUpdate(f.d.PlayingSeeking),n=NaN,a=this.getPlayerDuration(),this.stateMachine.lockCombineStatus([f.c.Pause,f.c.Ended,f.c.PlayingSeeking],[f.c.Pause,f.c.Ended]),r=function(){v.stateMachine.setStatus(f.a.Whiteboard,f.b.PlayingSeeking)},u=function(){t<a.whiteboard&&v.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause)},o=function(){v.whiteboard.pause()},c=function(){v.stateMachine.setStatus(f.a.Whiteboard,f.b.Ended)},h=function(){v.stateMachine.setStatus(f.a.Video,f.b.PlayingSeeking),n=window.setInterval((function(){v.video.readyState()>=f.f.HAVE_CURRENT_DATA&&(clearInterval(n),t<a.video?(v.video.pause(),v.stateMachine.setStatus(f.a.Video,f.b.Pause)):v.stateMachine.setStatus(f.a.Video,f.b.Ended))}),500)},d=function(){clearInterval(n),v.whiteboardEmitter.removeListener("buffering",r),v.whiteboardEmitter.removeListener("pause",u),v.whiteboardEmitter.removeListener("playing",o),v.whiteboardEmitter.removeListener("ended",c),v.video.off("seeking",h)},l=this.stateMachine.one(f.c.PlayingSeeking,function(){var e=s()(i.a.mark((function e(n){var r,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.current,s=r.video,u=r.whiteboard,s===f.b.Ended&&t<a.whiteboard?v.whiteboard.pause():u===f.b.Ended&&t<a.video&&v.video.pause();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),b=this.stateMachine.one(f.c.Pause,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.stateMachine.off([f.c.Ended]),d(),e.next=4,v.playWhenPause();case 4:case"end":return e.stop()}}),e)})))),p=this.stateMachine.one(f.c.Ended,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v.onStatusUpdate(f.d.Ended),v.stateMachine.off([f.c.Pause]),d();case 3:case"end":return e.stop()}}),e)})))),this.video.one("seeking",h),this.whiteboardEmitter.one("buffering",r),this.whiteboardEmitter.one("pause",u),this.whiteboardEmitter.one("playing",o),this.whiteboardEmitter.one("ended",c),this.whiteboard.seekToProgressTime(t),this.video.currentTime(t/1e3),e.next=22,Promise.all([l,Promise.race([b,p])]);case 22:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"seekWhenPause",value:(v=s()(i.a.mark((function e(t){var n,a,r,u,o,c,h,d=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.onStatusUpdate(f.d.PauseSeeking),n=NaN,this.stateMachine.lockCombineStatus([f.c.Disabled,f.c.Pause],[f.c.Pause]),a=function(){d.stateMachine.setStatus(f.a.Video,f.b.PauseSeeking),n=window.setInterval((function(){d.video.readyState()>=f.f.HAVE_CURRENT_DATA&&(clearInterval(n),d.stateMachine.setStatus(f.a.Video,f.b.Pause))}),500)},r=function(){d.stateMachine.setStatus(f.a.Whiteboard,f.b.PauseSeeking)},u=function(){d.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause)},o=function(){d.whiteboard.pause()},c=function(){clearInterval(n),d.video.off("seeking",a),d.whiteboardEmitter.removeListener("buffering",r),d.whiteboardEmitter.removeListener("pause",u)},this.stateMachine.oneButNotCrashByDisabled([{video:f.b.PauseSeeking,whiteboard:f.b.PauseSeeking}]).catch((function(e){throw Error(e)})),h=this.stateMachine.one(f.c.Pause,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d.onStatusUpdate(f.d.Pause),d.stateMachine.cancelOneButNotCrashByDisabled(),d.stateMachine.off(f.c.Ended),d.whiteboardEmitter.removeListener("playing",o),c();case 5:case"end":return e.stop()}}),e)})))),this.video.one("seeking",a),this.whiteboardEmitter.one("buffering",r),this.whiteboardEmitter.one("playing",o),this.whiteboardEmitter.one("pause",u),this.whiteboard.seekToProgressTime(t),this.video.currentTime(t/1e3),e.next=18,h;case 18:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"seekWhenPauseFinallyIsEnded",value:(p=s()(i.a.mark((function e(t,n){var a,r,u,o,c,h,d,l=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.onStatusUpdate(f.d.PauseSeeking),a=NaN,this.stateMachine.lockCombineStatus([f.c.Disabled,f.c.Ended],[f.c.Ended]),r=function(){l.stateMachine.setStatus(f.a.Video,f.b.PauseSeeking),a=window.setInterval((function(){l.video.readyState()>=f.f.HAVE_CURRENT_DATA&&(clearInterval(a),l.stateMachine.setStatus(f.a.Video,f.b.Pause),t>=n.video&&l.stateMachine.setStatus(f.a.Video,f.b.Ended))}),500)},u=function(){t<n.whiteboard&&l.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause)},o=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.PauseSeeking)},c=function(){l.stateMachine.setStatus(f.a.Whiteboard,f.b.Ended)},h=function(){clearInterval(a),l.video.off("seeking",r),l.whiteboardEmitter.removeListener("buffering",o),l.whiteboardEmitter.removeListener("pause",u),l.whiteboardEmitter.removeListener("ended",c)},this.stateMachine.oneButNotCrashByDisabled([{video:f.b.PauseSeeking,whiteboard:f.b.PauseSeeking}]).catch((function(e){throw Error(e)})),d=this.stateMachine.on(f.c.Ended,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.onStatusUpdate(f.d.Ended),l.stateMachine.cancelOneButNotCrashByDisabled(),l.stateMachine.off([f.c.Pause,f.c.Ended]),h();case 4:case"end":return e.stop()}}),e)})))),this.video.one("seeking",r),this.whiteboardEmitter.one("buffering",o),this.whiteboardEmitter.one("pause",u),this.whiteboardEmitter.one("ended",c),this.whiteboard.seekToProgressTime(t),this.video.currentTime(t/1e3),e.next=18,d;case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"pauseWhiteboardWhenVideoWaiting",value:(l=s()(i.a.mark((function e(){var t,n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("pause"!==this.whiteboard.phase){e.next=2;break}return e.abrupt("return");case 2:return t=this.stateMachine.one(f.c.PlayingBuffering),this.whiteboardEmitter.one("pause",(function(){n.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause)})),this.whiteboard.pause(),this.stateMachine.setStatus(f.a.Video,f.b.PlayingBuffering),e.next=8,t;case 8:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"playingWhiteboardWhenVideoPlayingDropFrame",value:function(){var e=this;this.whiteboardEmitter.one("pause",(function(){e.stateMachine.setStatus(f.a.Whiteboard,f.b.PauseBuffering)}));var t=this.stateMachine.one(f.c.PauseBuffering,s()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.triggerSource=f.e.Plugin,t.abrupt("return",e.playWhenVideoIsPauseAndWhiteboardIsPauseBuffering());case 2:case"end":return t.stop()}}),t)}))));return this.video.one("pause",(function(){e.stateMachine.setStatus(f.a.Video,f.b.Pause),e.whiteboard.seekToProgressTime(1e3*e.video.currentTime())})),this.video.pause(),t}},{key:"playingWhiteboardWhenVideoPlaying",value:(d=s()(i.a.mark((function e(){var t,n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stateMachine.setStatus(f.a.Video,f.b.Playing),t=this.stateMachine.one(f.c.Playing,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.onStatusUpdate(f.d.Playing);case 1:case"end":return e.stop()}}),e)})))),this.whiteboardEmitter.one("playing",(function(){n.stateMachine.setStatus(f.a.Whiteboard,f.b.Playing)})),this.whiteboard.play(),e.next=6,t;case 6:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"pauseVideoWhenWhiteboardBuffering",value:(c=s()(i.a.mark((function e(){var t,n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stateMachine.setStatus(f.a.Whiteboard,f.b.PlayingBuffering),this.onStatusUpdate(f.d.PlayingBuffering),!this.video.paused()){e.next=5;break}return this.stateMachine.setStatus(f.a.Video,f.b.Pause),e.abrupt("return");case 5:return this.video.one("pause",(function(){n.stateMachine.setStatus(f.a.Video,f.b.Pause)})),t=this.stateMachine.one(f.c.PlayingBuffering),this.video.pause(),this.stateMachine.setStatus(f.a.Whiteboard,f.b.PlayingBuffering),e.next=11,t;case 11:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"playingVideoWhenWhiteboardPlaying",value:(u=s()(i.a.mark((function e(){var t,n,a=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.stateMachine.one(f.c.ToPlay,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.video.play();case 1:case"end":return e.stop()}}),e)})))),n=this.stateMachine.one(f.c.Playing,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.onStatusUpdate(f.d.Playing);case 1:case"end":return e.stop()}}),e)})))),this.video.one("playing",(function(){a.stateMachine.setStatus(f.a.Video,f.b.Playing)})),this.stateMachine.setStatus(f.a.Whiteboard,f.b.Playing),e.next=6,Promise.all([t,n]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"pauseVideoWhenWhiteboardEnded",value:(r=s()(i.a.mark((function e(){var t,n,a=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stateMachine.setStatus(f.a.Whiteboard,f.b.Ended),(t=this.stateMachine.getStatus(f.a.Video).current)!==f.b.Ended&&t!==f.b.Pause){e.next=4;break}return e.abrupt("return");case 4:return n=this.stateMachine.one(f.c.Ended,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.onStatusUpdate(f.d.Ended);case 1:case"end":return e.stop()}}),e)})))),this.video.one("pause",(function(){a.stateMachine.setStatus(f.a.Video,f.b.Pause)})),this.video.pause(),e.next=9,n;case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"pauseWhiteboardWhenVideoEnded",value:(a=s()(i.a.mark((function e(){var t,n,a=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stateMachine.setStatus(f.a.Video,f.b.Ended),(t=this.stateMachine.getStatus(f.a.Whiteboard).current)!==f.b.Ended&&t!==f.b.Pause){e.next=4;break}return e.abrupt("return");case 4:return n=this.stateMachine.one(f.c.Ended,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.onStatusUpdate(f.d.Ended);case 1:case"end":return e.stop()}}),e)})))),this.whiteboardEmitter.one("pause",(function(){a.stateMachine.setStatus(f.a.Whiteboard,f.b.Pause)})),this.whiteboard.pause(),e.next=9,n;case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"releaseEvents",value:function(){this.taskQueue.destroy(),this.stateMachine.destroy(),this.whiteboardEmitter.destroy(),this.whiteboard.stop(),this.video.off()}},{key:"initOnCrashByDisabledStatusCallback",value:(n=s()(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stateMachine.setOnCrashByDisabledStatus((function(){t.releaseEvents(),t.onStatusUpdate(f.d.Disabled,b.a)}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onStatusUpdate",value:function(e,t){var n=this;this.isNotResponse()||this.currentCombineStatus!==e&&(this.currentCombineStatus=e,Promise.resolve().then((function(){n.onStatusChangeHandleList.forEach((function(n){"[object AsyncFunction]"==={}.toString.call(n)?n(e,t).catch((function(e){throw Error(e)})):n(e,t)}))})))}},{key:"getPlayerDuration",value:function(){return{whiteboard:this.whiteboard.timeDuration,video:1e3*this.video.duration()}}},{key:"isNotResponse",value:function(){var e=this.currentCombineStatus===f.d.Stopped||this.currentCombineStatus===f.d.Disabled;return e&&console.warn("Currently in the ".concat(this.currentCombineStatus," stage, the program will not respond to the current behavior")),e}},{key:"checkVideoAutoPlay",value:(t=s()(i.a.mark((function e(){var t,n,a,r,u,o,c,h,d,l=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.whiteboard.progressTime&&0===this.video.currentTime()){e.next=2;break}return e.abrupt("return",!0);case 2:if(t=this.stateMachine.getStatus(f.a.Video).current,n=this.stateMachine.getStatus(f.a.Whiteboard).current,(a=[f.b.Pause,f.b.PauseBuffering]).includes(t)&&a.includes(n)){e.next=7;break}return e.abrupt("return",!0);case 7:return this.stateMachine.oneButNotCrashByDisabled([{video:f.b.Playing,whiteboard:f.b.PauseBuffering}]).catch((function(e){throw new Error(e)})),r=function(){l.stateMachine.setStatus(f.a.Video,f.b.Playing)},u=function(){l.stateMachine.setStatus(f.a.Video,f.b.Pause)},o=this.stateMachine.one(f.c.ToPlay,s()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.video.pause();case 1:case"end":return e.stop()}}),e)})))),c=this.stateMachine.one(f.c.Pause),h=this.stateMachine.one(f.c.PauseBuffering),this.video.one("play",r),this.video.one("pause",u),d=function(){l.stateMachine.cancelOneButNotCrashByDisabled(),l.video.off("play",r),l.video.off("pause",u),l.stateMachine.off([f.c.ToPlay,f.c.Pause,f.c.PauseBuffering])},e.prev=16,e.next=19,this.video.play();case 19:e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(16),d(),e.abrupt("return",!1);case 25:return e.next=27,Promise.all([o,Promise.race([c,h])]);case 27:return d(),e.abrupt("return",!0);case 29:case"end":return e.stop()}}),e,this,[[16,21]])}))),function(){return t.apply(this,arguments)})},{key:"combinedStatus",get:function(){return this.currentCombineStatus}},{key:"playbackRate",set:function(e){this.isNotResponse()||(this._playbackRate=e,this.whiteboard.playbackSpeed=e,this.video.playbackRate(e))},get:function(){return this._playbackRate}},{key:"timeDuration",get:function(){var e=this.getPlayerDuration(),t=e.video,n=e.whiteboard;return{duration:Math.min(t,n),video:t,whiteboard:n}}}]),e}()},"./src/ErrorConstant.ts":function(e,t,n){"use strict";n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"g",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"i",(function(){return h})),n.d(t,"h",(function(){return d}));var a="[Combine-Player]: URL must be passed in during the instance",i="[Combine-Player]: Accidentally enter the prohibited area!",r="[Combine-Player]: In the current context, there can only be one state method that legally monitors disable",s="[Combine-Player]: Combine-player did stop",u="[Combine-Player]: Combine-player did crash",o="[Combine-Player]: Detects that you are passing both videoElementID and videoDOM parameters, please remove one of them",c="[Combine-Player]: Based on the videoElementID you provided, the relevant element could not be found in the page. Please make sure your element ID is correct",h="[Combine-Player]: Based on the videoElementID you provided, it is found that this element is not a video tag. Please make sure that the videoElementID you passed in is correct",d="[Combine-Player]: Based on the videoDOM you provided, it is found that this element is not a video tag. Please make sure that the videoDOM you passed in is correct"},"./src/EventEmitter.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("@babel/runtime/helpers/classCallCheck"),i=n.n(a),r=n("@babel/runtime/helpers/createClass"),s=n.n(r),u=function(e){return"function"!=typeof e},o=function(){function e(){i()(this,e),this.listeners=void 0,this.listeners=Object.create(null)}return s()(e,[{key:"addListener",value:function(e,t){if(u(t))throw Error("callback is not a function");var n=this.getEvent(e);n?n.push(t):this.listeners[e]=[t]}},{key:"removeListener",value:function(e,t){var n=this.getEvent(e);if(n)for(var a=0;a<n.length;a++){var i=n[a];i!==t&&i.realCallbackFn!==t||(this.listeners[e].splice(a,1),a--)}}},{key:"removeAllListener",value:function(e){this.getEvent(e)&&delete this.listeners[e]}},{key:"destroy",value:function(){var e=this;Object.keys(this.listeners).forEach((function(t){e.removeAllListener(t)}))}},{key:"one",value:function(e,t){var n=this;if(u(t))throw Error("callback is not a function");var a=function a(){"[object AsyncFunction]"==={}.toString.call(t)?t.apply(void 0,arguments).catch((function(e){throw Error(e)})):t.apply(void 0,arguments),n.removeListener(e,a)};a.realCallbackFn=t,this.addListener(e,a)}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var i=this.getEvent(e);i&&i.forEach((function(e){return e.apply(void 0,n)}))}},{key:"getEvent",value:function(e){return this.listeners[e]||null}}]),e}()},"./src/StatusContant.ts":function(e,t,n){"use strict";var a,i,r,s,u,o;n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return o})),function(e){e[e.PauseSeeking=0]="PauseSeeking",e[e.Pause=1]="Pause",e[e.PauseBuffering=2]="PauseBuffering",e[e.PlayingBuffering=3]="PlayingBuffering",e[e.Playing=4]="Playing",e[e.PlayingSeeking=5]="PlayingSeeking",e[e.Ended=6]="Ended"}(a||(a={})),function(e){e.PauseSeeking="PauseSeeking",e.PlayingSeeking="PlayingSeeking",e.PauseBuffering="PauseBuffering",e.PlayingBuffering="PlayingBuffering",e.ToPlay="ToPlay",e.ToPause="ToPause",e.Pause="Pause",e.Playing="Playing",e.Disabled="Disabled",e.Ended="Ended"}(i||(i={})),function(e){e.PauseSeeking="PauseSeeking",e.PlayingSeeking="PlayingSeeking",e.Pause="Pause",e.PauseBuffering="PauseBuffering",e.PlayingBuffering="PlayingBuffering",e.Playing="Playing",e.Ended="Ended",e.Disabled="Disabled",e.Stopped="Stopped"}(r||(r={})),function(e){e[e.Video=0]="Video",e[e.Whiteboard=1]="Whiteboard"}(s||(s={})),function(e){e[e.None=0]="None",e[e.Video=1]="Video",e[e.Whiteboard=2]="Whiteboard",e[e.Plugin=3]="Plugin"}(u||(u={})),function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(o||(o={}))},"./src/Types.ts":function(e,t){},"./src/Verification.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n("./src/ErrorConstant.ts"),i=function(e){if(!e.url)throw Error(a.e);if(void 0!==e.videoElementID){var t=document.getElementById(e.videoElementID);if(null===t)throw new Error(a.b);if("video"!==t.tagName.toLowerCase())throw new Error(a.i)}if(e.videoElementID&&e.videoDOM)throw new Error(a.g);if(void 0!==e.videoDOM&&"video"!==e.videoDOM.tagName.toLowerCase())throw new Error(a.h)}},"./src/index.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return P}));var a=n("@babel/runtime/helpers/defineProperty"),i=n.n(a),r=n("@babel/runtime/helpers/classCallCheck"),s=n.n(r),u=n("@babel/runtime/helpers/createClass"),o=n.n(u),c=n("./src/Verification.ts"),h=n("./src/EventEmitter.ts"),d=n("./src/CombinePlayerImplement.ts"),f=n("video.js"),l=n.n(f),b=n("./src/StatusContant.ts"),p=n("./src/Types.ts");for(var v in p)["default"].indexOf(v)<0&&function(e){n.d(t,e,(function(){return p[e]}))}(v);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n.d(t,"AtomPlayerStatus",(function(){return b.b})),n.d(t,"CombinePlayerStatus",(function(){return b.c})),n.d(t,"PublicCombinedStatus",(function(){return b.d})),n.d(t,"AtomPlayerSource",(function(){return b.a})),n.d(t,"TriggerSource",(function(){return b.e})),n.d(t,"VideoReadyState",(function(){return b.f}));var P=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s()(this,e),this.videoOptions=void 0,this.whiteboard=void 0,this.debug=void 0,Object(c.a)(n);var i=e.videoDefaultOptions(n);this.videoOptions=y(y(y({},i),n),{},{videoJsOptions:y(y({},i.videoJsOptions),n.videoJsOptions)}),this.whiteboard=t,this.debug=a}return o()(e,[{key:"create",value:function(){var t=new h.a;this.handleWhiteboardCallback(t);var n=this.getVideoDOM();e.setAdditionalVideoAttr(n);var a=l()(n,this.videoOptions.videoJsOptions);return a.src(this.videoOptions.url),a.playsinline(),new d.a({videoConfig:{videoOptions:this.videoOptions,video:a,isCanplay:a.readyState()>b.f.HAVE_CURRENT_DATA},whiteboard:this.whiteboard,whiteboardEmitter:t,debug:this.debug})}},{key:"getVideoDOM",value:function(){return void 0!==this.videoOptions.videoElementID?document.getElementById(this.videoOptions.videoElementID):this.videoOptions.videoDOM}},{key:"handleWhiteboardCallback",value:function(e){this.whiteboard.callbacks.on("onPhaseChanged",(function(t){e.emit(t)})),this.whiteboard.callbacks.on("onIsPlayableChanged",(function(t){e.emit("playableChange",t)}))}}],[{key:"videoDefaultOptions",value:function(e){var t={videoJsOptions:{preload:"auto"}};return e.videoDOM||e.videoElementID||(t.videoDOM=document.createElement("video")),t}},{key:"setAdditionalVideoAttr",value:function(e){e.setAttribute("playsInline","true"),e.setAttribute("webkit-playsinline","true")}}]),e}()},0:function(e,t,n){e.exports=n("./src/index.ts")},"@babel/runtime/helpers/asyncToGenerator":function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},"@babel/runtime/helpers/classCallCheck":function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},"@babel/runtime/helpers/createClass":function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},"@babel/runtime/helpers/defineProperty":function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},"@babel/runtime/regenerator":function(e,t){e.exports=require("@babel/runtime/regenerator")},"video.js":function(e,t){e.exports=require("video.js")}});